<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World's Mood</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #fff;
            overflow: hidden;
            height: 100vh;
            font-family: "Times New Roman", Times, serif;
        }

        #globeViz {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 50px; /* Initial margin - will animate down to 0 */
            left: 0;
            opacity: 0; /* Start invisible */
            transition: opacity 4s ease-in; /* Slower cinematic fade-in - top is handled by JS */
            /* Performance optimizations */
            will-change: transform;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        #globeViz canvas {
            display: block;
            width: 100% !important;
            height: 100% !important;
            /* Hardware acceleration */
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }

        #loading {
            position: fixed;
            top: calc(50% + 25px); /* Centered + half of globe's 50px margin */
            left: 50%;
            width: 510px;
            height: 510px;
            margin: -255px 0 0 -255px;
            border: 2px solid rgba(128, 128, 128, 0.15);
            border-top-color: rgba(128, 128, 128, 0.6);
            border-radius: 50%;
            z-index: 1000;
            animation: spin 4s linear infinite;
            opacity: 1;
            transition: opacity 1.5s ease-out;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #header {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 100;
            pointer-events: none;
        }
        
        #header h1 {
            margin: 0;
            font-size: 36px;
            font-weight: 300;
            letter-spacing: 3px;
            color: #000;
        }
        
        #header p {
            margin: 8px 0 0 0;
            font-size: 13px;
            color: #666;
            font-weight: 300;
            letter-spacing: 1px;
        }

        #footer {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #999;
            z-index: 100;
            pointer-events: none;
        }
        
        /* Headline link styles */
        .headline-link {
            font-size: 13px;
            line-height: 1.5;
            font-weight: 300;
            color: inherit;
            text-decoration: none;
            display: block;
            transition: color 0.2s, opacity 0.2s;
        }
        
        .headline-link:hover {
            color: #0066cc;
        }
        
        .headline-link.dimmed {
            opacity: 0.7;
        }
        
        .headline-link.dimmed:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>WORLD'S MOOD</h1>
        <p>Today's most prevalent words from global news</p>
    </div>
    <div id="loading"></div>
    <div id="globeViz"></div>
    <div id="footer">Updated: <span id="lastUpdate">Loading...</span></div>

    <script src="https://unpkg.com/globe.gl"></script>
    
    <script>
        let countryData = {};
        let headlinesData = {};
        let globe;

        // Country name mapping - GeoJSON names to our data names
        const countryNameMap = {
            'Russia': 'Russia',
            'Russian Federation': 'Russia',
            'United States of America': 'United States',
            'United Kingdom': 'United Kingdom',
            'Brazil': 'Brazil',
            'Nigeria': 'Nigeria',
            'Germany': 'Germany',
            'Spain': 'Spain',
            'Canada': 'Canada',
            'Japan': 'Japan',
            'Australia': 'Australia',
            'France': 'France',
            'India': 'India',
            'China': 'China',
            "People's Republic of China": 'China',
            'South Korea': 'South Korea',
            'Republic of Korea': 'South Korea',
            'Korea': 'South Korea',
            'Ukraine': 'Ukraine',
            'Sweden': 'Sweden',
            'Norway': 'Norway',
            'Denmark': 'Denmark',
            'Portugal': 'Portugal',
            'Netherlands': 'Netherlands',
            'The Netherlands': 'Netherlands',
            'Austria': 'Austria',
            'Hungary': 'Hungary',
            'Romania': 'Romania',
            'Bulgaria': 'Bulgaria',
            'Serbia': 'Serbia',
            'Croatia': 'Croatia',
            'Slovakia': 'Slovakia',
            'Slovak Republic': 'Slovakia',
            'Latvia': 'Latvia',
            'Estonia': 'Estonia',
            'Singapore': 'Singapore',
            'Chile': 'Chile',
            'Colombia': 'Colombia',
            'Peru': 'Peru',
            'Ecuador': 'Ecuador',
            'Morocco': 'Morocco',
            'Kazakhstan': 'Kazakhstan',
            'Dominican Republic': 'Dominican Republic',
            'Guatemala': 'Guatemala',
            'El Salvador': 'El Salvador',
            'Costa Rica': 'Costa Rica',
            'Panama': 'Panama',
            'Philippines': 'Philippines'
        };

        function getCountryData(geoCountryName) {
            // Try direct lookup first
            if (countryData[geoCountryName]) {
                return countryData[geoCountryName];
            }
            // Try mapped name
            const mappedName = countryNameMap[geoCountryName];
            if (mappedName && countryData[mappedName]) {
                return countryData[mappedName];
            }
            return null;
        }

        if (typeof Globe === 'undefined') {
            document.getElementById('loading').innerHTML = 'Error loading globe library';
        } else {
            initGlobe();
        }

        async function initGlobe() {
            // Load country data first
            try {
                console.log('Fetching country_data.json...');
                const dataResponse = await fetch('country_data.json');
                console.log('Response status:', dataResponse.status);
                
                if (!dataResponse.ok) {
                    throw new Error(`HTTP error! status: ${dataResponse.status}`);
                }
                
                const jsonData = await dataResponse.json();
                console.log('JSON parsed:', jsonData);
                countryData = jsonData.countries || jsonData;
                console.log('Loaded data for', Object.keys(countryData).length, 'countries');
                
                // Update footer with last update time
                if (jsonData.metadata && jsonData.metadata.generated_at) {
                    const date = new Date(jsonData.metadata.generated_at);
                    document.getElementById('lastUpdate').textContent = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                }
                
                // Load headlines data
                try {
                    const headlinesResponse = await fetch('headlines_data.json');
                    if (headlinesResponse.ok) {
                        headlinesData = await headlinesResponse.json();
                        console.log('Loaded headlines for', Object.keys(headlinesData).length, 'countries');
                    }
                } catch (headlinesError) {
                    console.warn('Headlines data not available:', headlinesError);
                }
            } catch (error) {
                console.error('Error loading country data:', error);
                document.getElementById('loading').innerHTML = 'Error loading country data: ' + error.message + '<br>Make sure the server is running in the correct directory!';
                return;
            }
            
            globe = Globe()
                (document.getElementById('globeViz'))
                .backgroundColor('#ffffff')
                .showGlobe(false)
                .showAtmosphere(false)
                .polygonCapColor(() => '#ffffff')
                .polygonSideColor(() => '#ffffff')
                .polygonStrokeColor(() => '#000000')
                .polygonAltitude(0.001)
                .polygonLabel(() => '') // No hover labels
                .onPolygonClick(({ properties: d }) => {
                    const geoCountryName = d.ADMIN || d.NAME || d.name;
                    const data = getCountryData(geoCountryName);
                    
                    if (data) {
                        const articlesWithWord = Math.round(data.num_articles * data.word_percentage / 100);
                        
                        // Use the mapped country name if available
                        const displayName = countryNameMap[geoCountryName] || geoCountryName;
                        
                        // Create and show custom tooltip
                        showTooltip(
                            displayName,
                            data.prevalent_word,
                            articlesWithWord,
                            data.num_articles
                        );
                    } else {
                        // Show "No data" tooltip for countries without data
                        const displayName = countryNameMap[geoCountryName] || geoCountryName;
                        showTooltip(displayName, 'No news data yet', 0, 0);
                    }
                    // Stop rotation on click
                    globe.controls().autoRotate = false;
                });

            fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json')
                .then(res => res.json())
                .then(countries => {
                    const { features } = topojson.feature(countries, countries.objects.countries);
                    globe.polygonsData(features);
                    
                    // List of all countries with positioning defined
                    const allPositionedCountries = [
                        'United States', 'Canada', 'United Kingdom', 'Germany', 'France', 'Japan', 
                        'Australia', 'Brazil', 'India', 'South Korea', 'Russia', 'China', 'Spain', 
                        'Nigeria', 'Ukraine', 'Sweden', 'Norway', 'Denmark', 'Portugal', 'Netherlands', 
                        'Austria', 'Hungary', 'Romania', 'Bulgaria', 'Serbia', 'Croatia', 'Slovakia', 
                        'Latvia', 'Estonia', 'Singapore', 'Chile', 'Colombia', 'Peru', 'Ecuador', 
                        'Morocco', 'Kazakhstan', 'Dominican Republic', 'Guatemala', 'El Salvador', 
                        'Costa Rica', 'Panama', 'Philippines', 'Mexico', 'Afghanistan', 'Albania', 
                        'Algeria', 'Andorra', 'Angola', 'Antigua and Barbuda', 'Argentina', 'Armenia', 
                        'Azerbaijan', 'Bahamas', 'Bahrain', 'Bangladesh', 'Barbados', 'Belarus', 
                        'Belgium', 'Belize', 'Benin', 'Bolivia', 'Bosnia and Herzegovina', 'Botswana', 
                        'Brunei', 'Burkina Faso', 'Burundi', 'Cambodia', 'Cameroon', 'Cabo Verde', 
                        'Central African Republic', 'Chad', 'Comoros', 'Democratic Republic of the Congo', 
                        'Republic of the Congo', 'Cote d\'Ivoire', 'Cuba', 'Cyprus', 'Czechia', 
                        'Djibouti', 'Dominica', 'Egypt', 'Equatorial Guinea', 'Eritrea', 'Eswatini', 
                        'Ethiopia', 'Fiji', 'Finland', 'Gabon', 'Gambia', 'Georgia', 'Ghana', 'Greece', 
                        'Grenada', 'Guinea', 'Guinea-Bissau', 'Guyana', 'Haiti', 'Honduras', 'Iceland', 
                        'Indonesia', 'Iran', 'Iraq', 'Ireland', 'Israel', 'Italy', 'Jamaica', 'Jordan', 
                        'Kenya', 'Kiribati', 'North Korea', 'Kosovo', 'Kuwait', 'Kyrgyzstan', 'Laos', 
                        'Lebanon', 'Lesotho', 'Liberia', 'Libya', 'Liechtenstein', 'Lithuania', 
                        'Luxembourg', 'Madagascar', 'Malawi', 'Malaysia', 'Maldives', 'Mali', 'Malta', 
                        'Marshall Islands', 'Mauritania', 'Mauritius', 'Micronesia', 'Moldova', 'Monaco', 
                        'Mongolia', 'Montenegro', 'Mozambique', 'Myanmar', 'Namibia', 'Nauru', 'Nepal', 
                        'New Zealand', 'Nicaragua', 'Niger', 'North Macedonia', 'Oman', 'Pakistan', 
                        'Palau', 'Papua New Guinea', 'Paraguay', 'Poland', 'Qatar', 'Rwanda', 
                        'Saint Kitts and Nevis', 'Saint Lucia', 'Saint Vincent and the Grenadines', 
                        'Samoa', 'San Marino', 'Sao Tome and Principe', 'Saudi Arabia', 'Senegal', 
                        'Seychelles', 'Sierra Leone', 'Slovenia', 'Solomon Islands', 'Somalia', 
                        'South Africa', 'South Sudan', 'Sri Lanka', 'Sudan', 'Suriname', 'Switzerland', 
                        'Syria', 'Tajikistan', 'Tanzania', 'Thailand', 'Timor-Leste', 'Togo', 'Tonga', 
                        'Trinidad and Tobago', 'Tunisia', 'Turkey', 'Turkmenistan', 'Tuvalu', 'Uganda', 
                        'United Arab Emirates', 'Uruguay', 'Uzbekistan', 'Vanuatu', 'Venezuela', 
                        'Vietnam', 'Yemen', 'Zambia', 'Zimbabwe'
                    ];
                    
                    const labels = Object.keys(countryData).map(countryName => {
                        // Only show labels for countries with actual data
                        const word = '"' + countryData[countryName].prevalent_word + '"';
                        const wordLength = word.length;
                        const wordPercentage = countryData[countryName].word_percentage;
                        
                        let lat, lng, baseSize, size;
                        
                        // Manual positioning for good visual placement
                        if (countryName === 'United States') { 
                            lat = 39.8283; lng = -98.5795; 
                            baseSize = 0.9; 
                        }
                        else if (countryName === 'Canada') { 
                            lat = 60; lng = -95;
                            baseSize = 0.8; 
                        }
                        else if (countryName === 'United Kingdom') { 
                            lat = 54; lng = -2; 
                            baseSize = 0.35;
                        }
                        else if (countryName === 'Germany') { 
                            lat = 51.1657; lng = 10.4515; 
                            baseSize = 0.4; 
                        }
                        else if (countryName === 'France') { 
                            lat = 46.2276; lng = 2.2137; 
                            baseSize = 0.35;
                        }
                        else if (countryName === 'Japan') { 
                            lat = 36.2048; lng = 138.2529; 
                            baseSize = 0.35; 
                        }
                        else if (countryName === 'Australia') { 
                            lat = -25.2744; lng = 133.7751; 
                            baseSize = 0.6;
                        }
                        else if (countryName === 'Brazil') { 
                            lat = -10; lng = -55; 
                            baseSize = 0.5;
                        }
                        else if (countryName === 'India') { 
                            lat = 20.5937; lng = 78.9629; 
                            baseSize = 0.4; 
                        }
                        else if (countryName === 'South Korea') { 
                            lat = 37; lng = 127.7669; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Russia') { 
                            lat = 61; lng = 105; 
                            baseSize = 1.2;
                        }
                        else if (countryName === 'China') { 
                            lat = 35; lng = 105; 
                            baseSize = 0.7;
                        }
                        else if (countryName === 'Spain') { 
                            lat = 40.4637; lng = -3.7492; 
                            baseSize = 0.4;
                        }
                        else if (countryName === 'Nigeria') { 
                            lat = 9.082; lng = 8.6753; 
                            baseSize = 0.45;
                        }
                        else if (countryName === 'Ukraine') { 
                            lat = 48.3794; lng = 31.1656; 
                            baseSize = 0.5;
                        }
                        else if (countryName === 'Sweden') { 
                            lat = 60.1282; lng = 18.6435; 
                            baseSize = 0.4;
                        }
                        else if (countryName === 'Norway') { 
                            lat = 60.472; lng = 8.4689; 
                            baseSize = 0.4;
                        }
                        else if (countryName === 'Denmark') { 
                            lat = 56.2639; lng = 9.5018; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Portugal') { 
                            lat = 39.3999; lng = -8.2245; 
                            baseSize = 0.35;
                        }
                        else if (countryName === 'Netherlands') { 
                            lat = 52.1326; lng = 5.2913; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Austria') { 
                            lat = 47.5162; lng = 14.5501; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Hungary') { 
                            lat = 47.1625; lng = 19.5033; 
                            baseSize = 0.35;
                        }
                        else if (countryName === 'Romania') { 
                            lat = 45.9432; lng = 24.9668; 
                            baseSize = 0.4;
                        }
                        else if (countryName === 'Bulgaria') { 
                            lat = 42.7339; lng = 25.4858; 
                            baseSize = 0.35;
                        }
                        else if (countryName === 'Serbia') { 
                            lat = 44.0165; lng = 21.0059; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Croatia') { 
                            lat = 45.1; lng = 15.2; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Slovakia') { 
                            lat = 48.669; lng = 19.699; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Latvia') { 
                            lat = 56.8796; lng = 24.6032; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Estonia') { 
                            lat = 58.5953; lng = 25.0136; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Singapore') { 
                            lat = 1.3521; lng = 103.8198; 
                            baseSize = 0.2;
                        }
                        else if (countryName === 'Chile') { 
                            lat = -35.6751; lng = -71.543; 
                            baseSize = 0.4;
                        }
                        else if (countryName === 'Colombia') { 
                            lat = 4.5709; lng = -74.2973; 
                            baseSize = 0.4;
                        }
                        else if (countryName === 'Peru') { 
                            lat = -9.19; lng = -75.0152; 
                            baseSize = 0.45;
                        }
                        else if (countryName === 'Ecuador') { 
                            lat = -1.8312; lng = -78.1834; 
                            baseSize = 0.35;
                        }
                        else if (countryName === 'Morocco') { 
                            lat = 31.7917; lng = -7.0926; 
                            baseSize = 0.4;
                        }
                        else if (countryName === 'Kazakhstan') { 
                            lat = 48.0196; lng = 66.9237; 
                            baseSize = 0.7;
                        }
                        else if (countryName === 'Dominican Republic') { 
                            lat = 18.7357; lng = -70.1627; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Guatemala') { 
                            lat = 15.7835; lng = -90.2308; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'El Salvador') { 
                            lat = 13.7942; lng = -88.8965; 
                            baseSize = 0.25;
                        }
                        else if (countryName === 'Costa Rica') { 
                            lat = 9.7489; lng = -83.7534; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Panama') { 
                            lat = 8.538; lng = -80.7821; 
                            baseSize = 0.3;
                        }
                        else if (countryName === 'Philippines') { 
                            lat = 12.8797; lng = 121.774; 
                            baseSize = 0.4;
                        }
                        // Additional countries from GDELT data
                        else if (countryName === 'Mexico') { lat = 23.6345; lng = -102.5528; baseSize = 0.6; }
                        else if (countryName === 'Afghanistan') { lat = 33.9391; lng = 67.7100; baseSize = 0.4; }
                        else if (countryName === 'Albania') { lat = 41.1533; lng = 20.1683; baseSize = 0.3; }
                        else if (countryName === 'Algeria') { lat = 28.0339; lng = 1.6596; baseSize = 0.6; }
                        else if (countryName === 'Andorra') { lat = 42.5063; lng = 1.5218; baseSize = 0.2; }
                        else if (countryName === 'Angola') { lat = -11.2027; lng = 17.8739; baseSize = 0.4; }
                        else if (countryName === 'Antigua and Barbuda') { lat = 17.0608; lng = -61.7964; baseSize = 0.2; }
                        else if (countryName === 'Argentina') { lat = -38.4161; lng = -63.6167; baseSize = 0.6; }
                        else if (countryName === 'Armenia') { lat = 40.0691; lng = 45.0382; baseSize = 0.3; }
                        else if (countryName === 'Azerbaijan') { lat = 40.1431; lng = 47.5769; baseSize = 0.3; }
                        else if (countryName === 'Bahamas') { lat = 25.0343; lng = -77.3963; baseSize = 0.3; }
                        else if (countryName === 'Bahrain') { lat = 26.0667; lng = 50.5577; baseSize = 0.2; }
                        else if (countryName === 'Bangladesh') { lat = 23.6850; lng = 90.3563; baseSize = 0.4; }
                        else if (countryName === 'Barbados') { lat = 13.1939; lng = -59.5432; baseSize = 0.2; }
                        else if (countryName === 'Belarus') { lat = 53.7098; lng = 27.9534; baseSize = 0.4; }
                        else if (countryName === 'Belgium') { lat = 50.5039; lng = 4.4699; baseSize = 0.3; }
                        else if (countryName === 'Belize') { lat = 17.1899; lng = -88.4976; baseSize = 0.3; }
                        else if (countryName === 'Benin') { lat = 9.3077; lng = 2.3158; baseSize = 0.3; }
                        else if (countryName === 'Bolivia') { lat = -16.2902; lng = -63.5887; baseSize = 0.45; }
                        else if (countryName === 'Bosnia and Herzegovina') { lat = 43.9159; lng = 17.6791; baseSize = 0.3; }
                        else if (countryName === 'Botswana') { lat = -22.3285; lng = 24.6849; baseSize = 0.4; }
                        else if (countryName === 'Brunei') { lat = 4.5353; lng = 114.7277; baseSize = 0.2; }
                        else if (countryName === 'Burkina Faso') { lat = 12.2383; lng = -1.5616; baseSize = 0.4; }
                        else if (countryName === 'Burundi') { lat = -3.3731; lng = 29.9189; baseSize = 0.3; }
                        else if (countryName === 'Cambodia') { lat = 12.5657; lng = 104.9910; baseSize = 0.4; }
                        else if (countryName === 'Cameroon') { lat = 7.3697; lng = 12.3547; baseSize = 0.4; }
                        else if (countryName === 'Cabo Verde') { lat = 16.5388; lng = -23.0418; baseSize = 0.2; }
                        else if (countryName === 'Central African Republic') { lat = 6.6111; lng = 20.9394; baseSize = 0.4; }
                        else if (countryName === 'Chad') { lat = 15.4542; lng = 18.7322; baseSize = 0.5; }
                        else if (countryName === 'Comoros') { lat = -11.6455; lng = 43.3333; baseSize = 0.2; }
                        else if (countryName === 'Democratic Republic of the Congo') { lat = -4.0383; lng = 21.7587; baseSize = 0.6; }
                        else if (countryName === 'Republic of the Congo') { lat = -0.228; lng = 15.8277; baseSize = 0.4; }
                        else if (countryName === 'Cote d\'Ivoire') { lat = 7.5400; lng = -5.5471; baseSize = 0.4; }
                        else if (countryName === 'Cuba') { lat = 21.5218; lng = -77.7812; baseSize = 0.4; }
                        else if (countryName === 'Cyprus') { lat = 35.1264; lng = 33.4299; baseSize = 0.3; }
                        else if (countryName === 'Czechia') { lat = 49.8175; lng = 15.4730; baseSize = 0.35; }
                        else if (countryName === 'Djibouti') { lat = 11.8251; lng = 42.5903; baseSize = 0.3; }
                        else if (countryName === 'Dominica') { lat = 15.4150; lng = -61.3710; baseSize = 0.2; }
                        else if (countryName === 'Egypt') { lat = 26.8206; lng = 30.8025; baseSize = 0.5; }
                        else if (countryName === 'Equatorial Guinea') { lat = 1.6508; lng = 10.2679; baseSize = 0.3; }
                        else if (countryName === 'Eritrea') { lat = 15.1794; lng = 39.7823; baseSize = 0.3; }
                        else if (countryName === 'Eswatini') { lat = -26.5225; lng = 31.4659; baseSize = 0.3; }
                        else if (countryName === 'Ethiopia') { lat = 9.1450; lng = 40.4897; baseSize = 0.5; }
                        else if (countryName === 'Fiji') { lat = -17.7134; lng = 178.0650; baseSize = 0.3; }
                        else if (countryName === 'Finland') { lat = 61.9241; lng = 25.7482; baseSize = 0.5; }
                        else if (countryName === 'Gabon') { lat = -0.8037; lng = 11.6094; baseSize = 0.4; }
                        else if (countryName === 'Gambia') { lat = 13.4432; lng = -15.3101; baseSize = 0.3; }
                        else if (countryName === 'Georgia') { lat = 42.3154; lng = 43.3569; baseSize = 0.3; }
                        else if (countryName === 'Ghana') { lat = 7.9465; lng = -1.0232; baseSize = 0.4; }
                        else if (countryName === 'Greece') { lat = 39.0742; lng = 21.8243; baseSize = 0.4; }
                        else if (countryName === 'Grenada') { lat = 12.1165; lng = -61.6790; baseSize = 0.2; }
                        else if (countryName === 'Guinea') { lat = 9.9456; lng = -9.6966; baseSize = 0.4; }
                        else if (countryName === 'Guinea-Bissau') { lat = 11.8037; lng = -15.1804; baseSize = 0.3; }
                        else if (countryName === 'Guyana') { lat = 4.8604; lng = -58.9302; baseSize = 0.4; }
                        else if (countryName === 'Haiti') { lat = 18.9712; lng = -72.2852; baseSize = 0.3; }
                        else if (countryName === 'Honduras') { lat = 15.2000; lng = -86.2419; baseSize = 0.35; }
                        else if (countryName === 'Iceland') { lat = 64.9631; lng = -19.0208; baseSize = 0.4; }
                        else if (countryName === 'Indonesia') { lat = -0.7893; lng = 113.9213; baseSize = 0.7; }
                        else if (countryName === 'Iran') { lat = 32.4279; lng = 53.6880; baseSize = 0.6; }
                        else if (countryName === 'Iraq') { lat = 33.2232; lng = 43.6793; baseSize = 0.5; }
                        else if (countryName === 'Ireland') { lat = 53.4129; lng = -8.2439; baseSize = 0.35; }
                        else if (countryName === 'Israel') { lat = 31.0461; lng = 34.8516; baseSize = 0.3; }
                        else if (countryName === 'Italy') { lat = 41.8719; lng = 12.5674; baseSize = 0.5; }
                        else if (countryName === 'Jamaica') { lat = 18.1096; lng = -77.2975; baseSize = 0.3; }
                        else if (countryName === 'Jordan') { lat = 30.5852; lng = 36.2384; baseSize = 0.35; }
                        else if (countryName === 'Kenya') { lat = -0.0236; lng = 37.9062; baseSize = 0.45; }
                        else if (countryName === 'Kiribati') { lat = -3.3704; lng = -168.7340; baseSize = 0.3; }
                        else if (countryName === 'North Korea') { lat = 40.3399; lng = 127.5101; baseSize = 0.4; }
                        else if (countryName === 'Kosovo') { lat = 42.6026; lng = 20.9030; baseSize = 0.3; }
                        else if (countryName === 'Kuwait') { lat = 29.3117; lng = 47.4818; baseSize = 0.3; }
                        else if (countryName === 'Kyrgyzstan') { lat = 41.2044; lng = 74.7661; baseSize = 0.4; }
                        else if (countryName === 'Laos') { lat = 19.8563; lng = 102.4955; baseSize = 0.4; }
                        else if (countryName === 'Lebanon') { lat = 33.8547; lng = 35.8623; baseSize = 0.3; }
                        else if (countryName === 'Lesotho') { lat = -29.6100; lng = 28.2336; baseSize = 0.3; }
                        else if (countryName === 'Liberia') { lat = 6.4281; lng = -9.4295; baseSize = 0.35; }
                        else if (countryName === 'Libya') { lat = 26.3351; lng = 17.2283; baseSize = 0.6; }
                        else if (countryName === 'Liechtenstein') { lat = 47.1660; lng = 9.5554; baseSize = 0.2; }
                        else if (countryName === 'Lithuania') { lat = 55.1694; lng = 23.8813; baseSize = 0.35; }
                        else if (countryName === 'Luxembourg') { lat = 49.8153; lng = 6.1296; baseSize = 0.25; }
                        else if (countryName === 'Madagascar') { lat = -18.7669; lng = 46.8691; baseSize = 0.45; }
                        else if (countryName === 'Malawi') { lat = -13.2543; lng = 34.3015; baseSize = 0.35; }
                        else if (countryName === 'Malaysia') { lat = 4.2105; lng = 101.9758; baseSize = 0.5; }
                        else if (countryName === 'Maldives') { lat = 3.2028; lng = 73.2207; baseSize = 0.2; }
                        else if (countryName === 'Mali') { lat = 17.5707; lng = -3.9962; baseSize = 0.5; }
                        else if (countryName === 'Malta') { lat = 35.9375; lng = 14.3754; baseSize = 0.2; }
                        else if (countryName === 'Marshall Islands') { lat = 7.1315; lng = 171.1845; baseSize = 0.2; }
                        else if (countryName === 'Mauritania') { lat = 21.0079; lng = -10.9408; baseSize = 0.5; }
                        else if (countryName === 'Mauritius') { lat = -20.3484; lng = 57.5522; baseSize = 0.3; }
                        else if (countryName === 'Micronesia') { lat = 7.4256; lng = 150.5508; baseSize = 0.2; }
                        else if (countryName === 'Moldova') { lat = 47.4116; lng = 28.3699; baseSize = 0.3; }
                        else if (countryName === 'Monaco') { lat = 43.7384; lng = 7.4246; baseSize = 0.2; }
                        else if (countryName === 'Mongolia') { lat = 46.8625; lng = 103.8467; baseSize = 0.6; }
                        else if (countryName === 'Montenegro') { lat = 42.7087; lng = 19.3744; baseSize = 0.3; }
                        else if (countryName === 'Mozambique') { lat = -18.6657; lng = 35.5296; baseSize = 0.5; }
                        else if (countryName === 'Myanmar') { lat = 21.9162; lng = 95.9560; baseSize = 0.5; }
                        else if (countryName === 'Namibia') { lat = -22.9576; lng = 18.4904; baseSize = 0.5; }
                        else if (countryName === 'Nauru') { lat = -0.5228; lng = 166.9315; baseSize = 0.2; }
                        else if (countryName === 'Nepal') { lat = 28.3949; lng = 84.1240; baseSize = 0.4; }
                        else if (countryName === 'New Zealand') { lat = -40.9006; lng = 174.8860; baseSize = 0.5; }
                        else if (countryName === 'Nicaragua') { lat = 12.8654; lng = -85.2072; baseSize = 0.35; }
                        else if (countryName === 'Niger') { lat = 17.6078; lng = 8.0817; baseSize = 0.5; }
                        else if (countryName === 'North Macedonia') { lat = 41.6086; lng = 21.7453; baseSize = 0.3; }
                        else if (countryName === 'Oman') { lat = 21.5126; lng = 55.9233; baseSize = 0.4; }
                        else if (countryName === 'Pakistan') { lat = 30.3753; lng = 69.3451; baseSize = 0.5; }
                        else if (countryName === 'Palau') { lat = 7.5150; lng = 134.5825; baseSize = 0.2; }
                        else if (countryName === 'Papua New Guinea') { lat = -6.3150; lng = 143.9555; baseSize = 0.45; }
                        else if (countryName === 'Paraguay') { lat = -23.4425; lng = -58.4438; baseSize = 0.4; }
                        else if (countryName === 'Poland') { lat = 51.9194; lng = 19.1451; baseSize = 0.5; }
                        else if (countryName === 'Qatar') { lat = 25.3548; lng = 51.1839; baseSize = 0.3; }
                        else if (countryName === 'Rwanda') { lat = -1.9403; lng = 29.8739; baseSize = 0.3; }
                        else if (countryName === 'Saint Kitts and Nevis') { lat = 17.3578; lng = -62.7830; baseSize = 0.2; }
                        else if (countryName === 'Saint Lucia') { lat = 13.9094; lng = -60.9789; baseSize = 0.2; }
                        else if (countryName === 'Saint Vincent and the Grenadines') { lat = 12.9843; lng = -61.2872; baseSize = 0.2; }
                        else if (countryName === 'Samoa') { lat = -13.7590; lng = -172.1046; baseSize = 0.3; }
                        else if (countryName === 'San Marino') { lat = 43.9424; lng = 12.4578; baseSize = 0.2; }
                        else if (countryName === 'Sao Tome and Principe') { lat = 0.1864; lng = 6.6131; baseSize = 0.2; }
                        else if (countryName === 'Saudi Arabia') { lat = 23.8859; lng = 45.0792; baseSize = 0.7; }
                        else if (countryName === 'Senegal') { lat = 14.4974; lng = -14.4524; baseSize = 0.4; }
                        else if (countryName === 'Seychelles') { lat = -4.6796; lng = 55.4920; baseSize = 0.2; }
                        else if (countryName === 'Sierra Leone') { lat = 8.4606; lng = -11.7799; baseSize = 0.35; }
                        else if (countryName === 'Slovenia') { lat = 46.1512; lng = 14.9955; baseSize = 0.3; }
                        else if (countryName === 'Solomon Islands') { lat = -9.6457; lng = 160.1562; baseSize = 0.3; }
                        else if (countryName === 'Somalia') { lat = 5.1521; lng = 46.1996; baseSize = 0.5; }
                        else if (countryName === 'South Africa') { lat = -30.5595; lng = 22.9375; baseSize = 0.6; }
                        else if (countryName === 'South Sudan') { lat = 6.8770; lng = 31.3070; baseSize = 0.5; }
                        else if (countryName === 'Sri Lanka') { lat = 7.8731; lng = 80.7718; baseSize = 0.35; }
                        else if (countryName === 'Sudan') { lat = 12.8628; lng = 30.2176; baseSize = 0.6; }
                        else if (countryName === 'Suriname') { lat = 3.9193; lng = -56.0278; baseSize = 0.4; }
                        else if (countryName === 'Switzerland') { lat = 46.8182; lng = 8.2275; baseSize = 0.35; }
                        else if (countryName === 'Syria') { lat = 34.8021; lng = 38.9968; baseSize = 0.4; }
                        else if (countryName === 'Tajikistan') { lat = 38.8610; lng = 71.2761; baseSize = 0.4; }
                        else if (countryName === 'Tanzania') { lat = -6.3690; lng = 34.8888; baseSize = 0.5; }
                        else if (countryName === 'Thailand') { lat = 15.8700; lng = 100.9925; baseSize = 0.5; }
                        else if (countryName === 'Timor-Leste') { lat = -8.8742; lng = 125.7275; baseSize = 0.3; }
                        else if (countryName === 'Togo') { lat = 8.6195; lng = 0.8248; baseSize = 0.3; }
                        else if (countryName === 'Tonga') { lat = -21.1789; lng = -175.1982; baseSize = 0.2; }
                        else if (countryName === 'Trinidad and Tobago') { lat = 10.6918; lng = -61.2225; baseSize = 0.3; }
                        else if (countryName === 'Tunisia') { lat = 33.8869; lng = 9.5375; baseSize = 0.4; }
                        else if (countryName === 'Turkey') { lat = 38.9637; lng = 35.2433; baseSize = 0.6; }
                        else if (countryName === 'Turkmenistan') { lat = 38.9697; lng = 59.5563; baseSize = 0.5; }
                        else if (countryName === 'Tuvalu') { lat = -7.1095; lng = 177.6493; baseSize = 0.2; }
                        else if (countryName === 'Uganda') { lat = 1.3733; lng = 32.2903; baseSize = 0.4; }
                        else if (countryName === 'United Arab Emirates') { lat = 23.4241; lng = 53.8478; baseSize = 0.35; }
                        else if (countryName === 'Uruguay') { lat = -32.5228; lng = -55.7658; baseSize = 0.4; }
                        else if (countryName === 'Uzbekistan') { lat = 41.3775; lng = 64.5853; baseSize = 0.5; }
                        else if (countryName === 'Vanuatu') { lat = -15.3767; lng = 166.9592; baseSize = 0.3; }
                        else if (countryName === 'Venezuela') { lat = 6.4238; lng = -66.5897; baseSize = 0.5; }
                        else if (countryName === 'Vietnam') { lat = 14.0583; lng = 108.2772; baseSize = 0.5; }
                        else if (countryName === 'Yemen') { lat = 15.5527; lng = 48.5164; baseSize = 0.5; }
                        else if (countryName === 'Zambia') { lat = -13.1339; lng = 27.8493; baseSize = 0.5; }
                        else if (countryName === 'Zimbabwe') { lat = -19.0154; lng = 29.1549; baseSize = 0.4; }
                        else {
                            // Default: skip countries without specific positioning
                            return null;
                        }
                        
                        if (!lat || !lng || !baseSize) return null;
                        
                        size = baseSize * (8 / Math.max(wordLength, 4));
                        size = Math.max(size, 0.25);
                        size = Math.min(size, 0.8);
                        
            // Calculate color opacity based on word percentage
            // Special handling for low article counts to prevent misleading prominence
            const numArticles = countryData[countryName].num_articles;
            let opacity;
            
            if (numArticles <= 4) {
                // Low sample size: cap opacity at 50% to indicate low confidence
                opacity = 0.5;
            } else {
                // Normal calculation: Linear gradient based on word percentage
                // 2% or less = light grey (15% opacity)
                // 50% or more = black (100% opacity)
                const minPct = 2;
                const maxPct = 50;
                
                if (wordPercentage <= minPct) {
                    opacity = 0.15;
                } else if (wordPercentage >= maxPct) {
                    opacity = 1.0;
                } else {
                    // Linear interpolation
                    const normalized = (wordPercentage - minPct) / (maxPct - minPct);
                    // Map to opacity range: 0.15 to 1.0
                    opacity = 0.15 + normalized * 0.85;
                }
            }
            
            const color = `rgba(0, 0, 0, ${opacity})`;
                        
                        return {
                            lat: lat,
                            lng: lng,
                            text: word,
                            size: size,
                            color: color,
                            countryName: countryName // Store country name for click handler
                        };
                    }).filter(label => label !== null); // Remove nulls
                    
                    console.log('Showing labels for', labels.length, 'countries');
                    
                    globe.labelsData(labels)
                        .labelLat('lat')
                        .labelLng('lng')
                        .labelText('text')
                        .labelSize('size')
                        .labelColor('color')
                        .labelDotRadius(0)
                        .labelAltitude(0.002)
                        .labelResolution(2) // Reduced from 3 for better performance
                        .onLabelClick(label => {
                            // Use the stored country name from the label
                            const countryName = label.countryName;
                            const data = countryData[countryName];
                            
                            if (data) {
                                const articlesWithWord = Math.round(data.num_articles * data.word_percentage / 100);
                                
                                showTooltip(
                                    countryName,
                                    data.prevalent_word,
                                    articlesWithWord,
                                    data.num_articles
                                );
                                
                                // Stop rotation on click
                                globe.controls().autoRotate = false;
                            }
                        });
                    
                    // Cinematic reveal: fade out loading text, fade in globe
                    const loadingEl = document.getElementById('loading');
                    loadingEl.style.opacity = '0';
                    setTimeout(() => {
                        loadingEl.style.display = 'none';
                    }, 1000);
                    
                    // Trigger cinematic fade-in animation after delay
                    setTimeout(() => {
                        document.getElementById('globeViz').style.opacity = '1';
                    }, 500);
                })
                .catch(err => {
                    console.error('Error loading country data:', err);
                    document.getElementById('loading').innerHTML = 'Error loading map data';
                });

            // Standard smooth controls
            globe.controls().enableDamping = true;
            globe.controls().dampingFactor = 0.05; // Standard smooth damping
            globe.controls().rotateSpeed = 1.0; // Normal speed
            
            // Dynamic header/footer based on zoom level
            function updateUIBasedOnZoom() {
                const pov = globe.pointOfView();
                const altitude = pov.altitude;
                
                const header = document.getElementById('header');
                const footer = document.getElementById('footer');
                const globeViz = document.getElementById('globeViz');
                
                // Map altitude to movement - start moving immediately!
                // altitude starts at 1.8, zooming in goes down to ~0.5 or less
                const maxAltitude = 2.0; // Start before default position
                const minAltitude = 1.0; // Move away even faster
                
                // Calculate zoom ratio (0 = zoomed in, 1 = zoomed out)
                const zoomRatio = Math.max(0, Math.min(1, (altitude - minAltitude) / (maxAltitude - minAltitude)));
                
                // Header moves up quickly as you zoom in
                // When zoomRatio = 1 (far): offset = 0
                // When zoomRatio = 0 (close): offset = -400px (far out of view)
                const headerOffset = -400 * Math.pow(1 - zoomRatio, 1.65); // Higher exponent = faster disappearance
                header.style.transform = `translateX(-50%) translateY(${headerOffset}px)`;
                header.style.opacity = 1;
                
                // Footer moves down and out of view
                const footerOffset = 200 * Math.pow(1 - zoomRatio, 2);
                footer.style.transform = `translateX(-50%) translateY(${footerOffset}px)`;
                footer.style.opacity = 1;
                
                // Globe margin disappears smoothly as you zoom in
                // Calculate how close the globe is to touching the top
                // At altitude 2.4 (far): full 50px margin
                // As altitude decreases: margin smoothly reduces
                // Margin fully gone at altitude 1.3 (earlier than before to prevent visible margin when zoomed)
                const marginStartAltitude = 2.4; // Starting altitude
                const marginEndAltitude = 1.4;   // Altitude when margin should be fully gone (increased from 1.0)
                
                // Calculate margin based on current altitude
                let marginRatio = (altitude - marginEndAltitude) / (marginStartAltitude - marginEndAltitude);
                marginRatio = Math.max(0, Math.min(1, marginRatio)); // Clamp between 0 and 1
                
                // Apply sigmoid (S-curve) function for ultra-smooth blending with zoom
                // Sigmoid smoothly eases in and out, matching the natural feel of zooming
                const sigmoid = (x) => {
                    // Adjust x to center the sigmoid curve
                    const centered = (x - 0.5) * 6; // 6 = gentler curve, slower middle transition
                    return 1 / (1 + Math.exp(-centered));
                };
                
                const easedMarginRatio = sigmoid(marginRatio);
                const topMargin = 50 * easedMarginRatio;
                
                globeViz.style.top = `${topMargin}px`;
            }
            
            // Dynamic zoom movement - header/footer slide away when zooming in
            globe.controls().addEventListener('change', updateUIBasedOnZoom);
            
            // Start with good overview - slightly zoomed in for better initial view
            globe.pointOfView({ lat: 0, lng: 0, altitude: 2.0 });
            
            // Initial update - sets correct position on load
            updateUIBasedOnZoom();
            
            // Auto-rotation until user interacts
            let autoRotate = true;
            let rotationAngle = 0;
            let lastFrameTime = 0;
            const frameDelay = 1000 / 60; // Target 60 FPS max
            
            function animate(currentTime) {
                if (autoRotate && (currentTime - lastFrameTime >= frameDelay)) {
                    rotationAngle += 0.015; // Slightly slower for smoother performance
                    globe.pointOfView({ lat: 0, lng: rotationAngle, altitude: 2.0 }, 0); // No transition for smooth rotation
                    lastFrameTime = currentTime;
                }
                requestAnimationFrame(animate);
            }
            animate(0);
            
            // Stop auto-rotation on first user interaction
            const controls = globe.controls();
            const stopRotation = () => {
                autoRotate = false;
            };
            
            controls.addEventListener('start', stopRotation); // Mouse/touch down
            controls.addEventListener('wheel', stopRotation); // Scroll wheel
        }

        // Custom tooltip function
        let tooltipDiv = null;
        let headlinesDiv = null;
        
        function showTooltip(country, word, articlesWithWord, totalArticles) {
            // Remove existing tooltip
            if (tooltipDiv) {
                tooltipDiv.remove();
            }
            
            // Create new tooltip
            tooltipDiv = document.createElement('div');
            tooltipDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #ffffff;
                padding: 20px 28px;
                border: none;
                color: black;
                font-size: 14px;
                z-index: 1000;
                filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.9)) drop-shadow(0 0 40px rgba(255, 255, 255, 0.6));
                box-shadow: 0 0 60px 20px rgba(255, 255, 255, 0.8);
            `;
            
            // Check if this is a "no data" country
            if (totalArticles === 0 && word === 'No news data yet') {
                tooltipDiv.innerHTML = `
                    <div style="font-weight: 400; margin-bottom: 6px; font-size: 15px;">${country}</div>
                    <div style="font-size: 14px; font-weight: 300; color: #666;">No news data available</div>
                `;
            } else {
                const hasHeadlines = headlinesData[country] && (headlinesData[country].with_word.length > 0 || headlinesData[country].without_word.length > 0);
                
                // Check if this country has older data
                const data = countryData[country];
                const timeframe = data && data.timeframe ? data.timeframe : '24h';
                const isOlderData = timeframe !== '24h';
                const timeframeText = timeframe === '7d' ? '7 days' : '30 days';
                
                tooltipDiv.innerHTML = `
                    <div style="font-weight: 400; margin-bottom: 6px; font-size: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>${country}</span>
                        ${isOlderData ? `<span class="info-indicator" style="position: relative; display: inline-block; font-size: 11px; color: #888; cursor: help; font-weight: 300;">(i) older data<span class="info-hover" style="display: none; position: absolute; left: 0; top: 100%; margin-top: 4px; background: #f5f5f5; color: #333; padding: 8px 12px; border-radius: 4px; white-space: nowrap; font-size: 11px; z-index: 10000; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">No news found for today<br>Displaying results from last ${timeframeText}</span></span>` : ''}
                    </div>
                    <div style="font-size: 18px; font-weight: 400; margin-bottom: 6px;">"${word}"</div>
                    <div style="font-size: 12px; font-weight: 300; margin-bottom: ${hasHeadlines ? '12px' : '0'};">appears in ${articlesWithWord}/${totalArticles} articles</div>
                    ${hasHeadlines ? `<button onclick="showHeadlines('${country.replace(/'/g, "\\'")}'); event.stopPropagation();" style="padding: 6px 14px; background: #000; color: #fff; border: none; font-family: 'Times New Roman', Times, serif; font-size: 12px; cursor: pointer; font-weight: 300; letter-spacing: 0.5px;">See Headlines</button>` : ''}
                `;
                
                // Add hover functionality for info indicator
                if (isOlderData) {
                    setTimeout(() => {
                        const indicator = tooltipDiv.querySelector('.info-indicator');
                        const hover = tooltipDiv.querySelector('.info-hover');
                        if (indicator && hover) {
                            indicator.addEventListener('mouseenter', () => {
                                hover.style.display = 'block';
                            });
                            indicator.addEventListener('mouseleave', () => {
                                hover.style.display = 'none';
                            });
                        }
                    }, 10);
                }
            }
            
            document.body.appendChild(tooltipDiv);
            
            // Close on click anywhere
            setTimeout(() => {
                document.addEventListener('click', function closeTooltip() {
                    if (tooltipDiv) {
                        tooltipDiv.remove();
                        tooltipDiv = null;
                    }
                    document.removeEventListener('click', closeTooltip);
                }, 100);
            }, 100);
        }
        
        // Headlines viewer function
        function showHeadlines(country) {
            // Close any existing tooltips or headlines
            if (tooltipDiv) {
                tooltipDiv.remove();
                tooltipDiv = null;
            }
            if (headlinesDiv) {
                headlinesDiv.remove();
            }
            
            const headlines = headlinesData[country];
            if (!headlines) {
                console.warn('No headlines data for', country);
                return;
            }
            
            const data = countryData[country];
            const word = data ? data.prevalent_word : '';
            
            // Create headlines popup
            headlinesDiv = document.createElement('div');
            headlinesDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #ffffff;
                padding: 24px 28px;
                border: none;
                color: black;
                font-size: 13px;
                z-index: 1001;
                filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.9)) drop-shadow(0 0 40px rgba(255, 255, 255, 0.6));
                box-shadow: 0 0 60px 20px rgba(255, 255, 255, 0.8);
                max-width: 600px;
                max-height: 70vh;
                width: 90vw;
                display: flex;
                flex-direction: column;
            `;
            
            // Create content with headlines
            let headlinesHTML = `
                <div style="font-weight: 400; margin-bottom: 16px; font-size: 16px; display: flex; justify-content: space-between; align-items: center;">
                    <span>${country}</span>
                    <button onclick="headlinesDiv.remove(); headlinesDiv = null;" style="background: none; border: none; font-size: 20px; cursor: pointer; padding: 0; width: 24px; height: 24px; line-height: 20px; color: #666;">&times;</button>
                </div>
            `;
            
            // Scrollable content
            headlinesHTML += `<div style="overflow-y: auto; overflow-x: hidden; flex: 1; margin: -4px -8px; padding: 4px 8px;">`;
            
            // Headlines with the word (on top)
            if (headlines.with_word && headlines.with_word.length > 0) {
                headlinesHTML += `
                    <div style="margin-bottom: 16px;">
                        <div style="font-size: 11px; font-weight: 400; color: #666; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">Headlines with "${word}"</div>
                `;
                headlines.with_word.forEach(headline => {
                    const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(headline)}`;
                    headlinesHTML += `
                        <div style="padding: 8px 0; border-bottom: 1px solid #eee;">
                            <a href="${searchUrl}" target="_blank" rel="noopener noreferrer" class="headline-link">
                                ${headline}
                            </a>
                        </div>
                    `;
                });
                headlinesHTML += `</div>`;
            }
            
            // Other headlines
            if (headlines.without_word && headlines.without_word.length > 0) {
                headlinesHTML += `
                    <div>
                        <div style="font-size: 11px; font-weight: 400; color: #666; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">Other Headlines</div>
                `;
                headlines.without_word.forEach(headline => {
                    const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(headline)}`;
                    headlinesHTML += `
                        <div style="padding: 8px 0; border-bottom: 1px solid #eee;">
                            <a href="${searchUrl}" target="_blank" rel="noopener noreferrer" class="headline-link dimmed">
                                ${headline}
                            </a>
                        </div>
                    `;
                });
                headlinesHTML += `</div>`;
            }
            
            headlinesHTML += `</div>`; // Close scrollable content
            
            headlinesDiv.innerHTML = headlinesHTML;
            document.body.appendChild(headlinesDiv);
            
            // Close on click outside
            setTimeout(() => {
                document.addEventListener('click', function closeHeadlines(e) {
                    if (headlinesDiv && !headlinesDiv.contains(e.target)) {
                        headlinesDiv.remove();
                        headlinesDiv = null;
                        document.removeEventListener('click', closeHeadlines);
                    }
                }, 100);
            }, 100);
        }
    </script>
    
    <script src="https://unpkg.com/topojson-client@3"></script>
</body>
</html>